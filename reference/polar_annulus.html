<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Typically plots the concentration of a pollutant by wind direction and as a
function of time as an annulus. The function is good for visualising how
concentrations of pollutants vary by wind direction and a time period, e.g.,
by month, day of week, etc."><title>Bivariate polarAnnulus plot — polar_annulus • ggopenair</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bivariate polarAnnulus plot — polar_annulus"><meta property="og:description" content="Typically plots the concentration of a pollutant by wind direction and as a
function of time as an annulus. The function is good for visualising how
concentrations of pollutants vary by wind direction and a time period, e.g.,
by month, day of week, etc."><meta property="og:image" content="https://jack-davison.github.io/ggopenair/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ggopenair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ggopenair-polar.html">Polar Analysis</a>
    <a class="dropdown-item" href="../articles/ggopenair-traj.html">Trajectory Analysis</a>
    <a class="dropdown-item" href="../articles/ggopenair-trends.html">Time Series and Trends</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Bivariate polarAnnulus plot</h1>
      
      <div class="d-none name"><code>polar_annulus.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Typically plots the concentration of a pollutant by wind direction and as a
function of time as an annulus. The function is good for visualising how
concentrations of pollutants vary by wind direction and a time period, e.g.,
by month, day of week, etc.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">polar_annulus</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">pollutant</span>,</span>
<span>  local_tz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  period <span class="op">=</span> <span class="st">"hour"</span>,</span>
<span>  facet <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  percentile <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  min_bin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  exclude_missing <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pad_date <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  force_positive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  normalise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A data frame containing wind direction, wind speed, and pollutant
concentrations.</p></dd>


<dt>pollutant</dt>
<dd><p>One or more column names identifying pollutant
concentrations. When multiple pollutants are specified for a
single-pollutant <code>statistic</code> (e.g., "mean"), a faceted plot will be
returned. Two pollutants must be provided for certain <code>statistic</code>
options (e.g., "Pearson" in <code><a href="polar_plot.html">polar_plot()</a></code>).</p></dd>


<dt>local_tz</dt>
<dd><p>Should the results be calculated in local time that includes
a treatment of daylight savings time (DST)? The default is not to consider
DST issues, provided the data were imported without a DST offset. Emissions
activity tends to occur at local time e.g. rush hour is at 8 am every day.
When the clocks go forward in spring, the emissions are effectively
released into the atmosphere typically 1 hour earlier during the summertime
i.e. when DST applies. When plotting diurnal profiles, this has the effect
of “smearing-out” the concentrations. Sometimes, a useful approach
is to express time as local time. This correction tends to produce
better-defined diurnal profiles of concentration (or other variables) and
allows a better comparison to be made with emissions/activity data. If set
to <code>FALSE</code> then GMT is used. Examples of usage include <code>local_tz
  = "Europe/London"</code>, <code>local_tz = "America/New_York"</code>. See
<code>cutData</code> and <code>import</code> for more details.</p></dd>


<dt>period</dt>
<dd><p>This determines the temporal period to consider. Options are
“hour” (the default, to plot diurnal variations), “season” to
plot variation throughout the year, “weekday” to plot day of the
week variation and “trend” to plot the trend by wind direction.</p></dd>


<dt>facet</dt>
<dd><p>One or two faceting columns. <code>facet</code> determines how the
data are split and then plotted. When <code>facet</code> is length 1 it is passed
to <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">ggplot2::facet_wrap()</a></code>, and when it is length 2 it is passed to
<code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">ggplot2::facet_grid()</a></code> with the first element being used as columns and
the second rows. Some other options (e.g., multiple <code>pollutant</code>
columns) can limit the the number of faceting columns to 1.</p></dd>


<dt>statistic</dt>
<dd><p>The statistic that should be applied to each wind
speed/direction bin. Can be “mean” (default), “median”,
“max” (maximum), “frequency”. “stdev” (standard
deviation), “weighted.mean” or “cpf” (Conditional Probability
Function). Because of the smoothing involved, the colour scale for some of
these statistics is only to provide an indication of overall pattern and
should not be interpreted in concentration units e.g. for <code>statistic =
  "weighted.mean"</code> where the bin mean is multiplied by the bin frequency and
divided by the total frequency. In many cases using <code>polarFreq</code> will
be better. Setting <code>statistic = "weighted.mean"</code> can be useful because
it provides an indication of the concentration * frequency of occurrence
and will highlight the wind speed/direction conditions that dominate the
overall mean.</p></dd>


<dt>percentile</dt>
<dd><p>If <code>statistic = "percentile"</code> or <code>statistic =
  "cpf"</code> then <code>percentile</code> is used, expressed from 0 to 100. Note that
the percentile value is calculated in the wind speed, wind direction
‘bins’. For this reason it can also be useful to set <code>min_bin</code>
to ensure there are a sufficient number of points available to estimate a
percentile. See <code>quantile</code> for more details of how percentiles are
calculated.</p></dd>


<dt>width</dt>
<dd><p>The relative width of the annulus compared to the width of the
inner white space. <code>width = 2</code> makes the annulus twice as wide as the inner
circle, whereas <code>width = 0.5</code> makes the annulus half as wide as the inner
circle. Defaults to <code>1</code>.</p></dd>


<dt>min_bin</dt>
<dd><p>The minimum number of points allowed in a wind speed/wind
direction bin.  The default is 1. A value of two requires at least 2 valid
records in each bin an so on; bins with less than 2 valid records are set
to NA. Care should be taken when using a value &gt; 1 because of the risk of
removing real data points.</p></dd>


<dt>exclude_missing</dt>
<dd><p>Setting this option to <code>TRUE</code> (the default)
removes points from the plot that are too far from the original data. The
smoothing routines will produce predictions at points where no data exist
i.e. they predict. By removing the points too far from the original data
produces a plot where it is clear where the original data lie. If set to
<code>FALSE</code> missing data will be interpolated.</p></dd>


<dt>pad_date</dt>
<dd><p>For <code>type = "trend"</code> (default), <code>pad_date = TRUE</code>
will pad-out missing data to the beginning of the first year and the end of
the last year. The purpose is to ensure that the trend plot begins and ends
at the beginning or end of year.</p></dd>


<dt>force_positive</dt>
<dd><p>The default is <code>TRUE</code>. Sometimes if smoothing data
with steep gradients it is possible for predicted values to be negative.
<code>force_positive = TRUE</code> ensures that predictions remain positive. This
is useful for several reasons. First, with lots of missing data more
interpolation is needed and this can result in artifacts because the
predictions are too far from the original data. Second, if it is known
beforehand that the data are all positive, then this option carries that
assumption through to the prediction. The only likely time where setting
<code>force_positive = FALSE</code> would be if background concentrations were
first subtracted resulting in data that is legitimately negative. For the
vast majority of situations it is expected that the user will not need to
alter the default option.</p></dd>


<dt>k</dt>
<dd><p>The smoothing value supplied to <code>gam</code> for the temporal and wind
direction components, respectively. In some cases e.g. a trend plot with
less than 1-year of data the smoothing with the default values may become
too noisy and affected more by outliers. Choosing a lower value of <code>k</code>
(say 10) may help produce a better plot.</p></dd>


<dt>normalise</dt>
<dd><p>If <code>TRUE</code> concentrations are normalised by dividing by
their mean value. This is done <em>after</em> fitting the smooth surface.
This option is particularly useful if one is interested in the patterns of
concentrations for several pollutants on different scales e.g. NOx and CO.
Often useful if more than one <code>pollutant</code> is chosen.</p></dd>


<dt>alpha</dt>
<dd><p>The transparency of the plot. This is mainly useful to overlay
it on a map.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>As well as generating the plot itself, <code>polarAnnulus</code> also
returns an object of class ``openair''. The object includes three main
components: <code>call</code>, the command used to generate the plot;
<code>data</code>, the data frame of summarised information used to make the
plot; and <code>plot</code>, the plot itself. If retained, e.g. using
<code>output &lt;- polarAnnulus(mydata, "nox")</code>, this output can be used to
recover the data, reproduce or rework the original plot or undertake
further analysis.</p>


<p>An openair output can be manipulated using a number of generic operations,
including <code>print</code>, <code>plot</code> and <code>summary</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>polar_annulus()</code> shares many of the properties of the <code><a href="polar_plot.html">polar_plot()</a></code>.
However, <code>polar_annulus()</code> is focussed on displaying information on how
concentrations of a pollutant (values of another variable) vary with wind
direction and time. Plotting as an annulus helps to reduce compression of
information towards the centre of the plot. The circular plot is easy to
interpret because wind direction is most easily understood in polar rather
than Cartesian coordinates.</p>
<p>The inner part of the annulus represents the earliest time and the outer part
of the annulus the latest time. The time dimension can be shown in many ways
including "trend", "hour" (hour or day), "season" (month of the year) and
"weekday" (day of the week). Taking hour as an example, the plot will show
how concentrations vary by hour of the day and wind direction. Such plots can
be very useful for understanding how different source influences affect a
location.</p>
<p>For <code>type = "trend"</code> the amount of smoothing does not vary linearly with
the length of the time series, i.e., a certain amount of smoothing per unit
interval in time. This is a deliberate choice because should one be
interested in a subset (in time) of data, more detail will be provided for
the subset compared with the full data set. This allows users to investigate
specific periods in more detail. Full flexibility is given through the
smoothing parameter <code>k</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other polar directional analysis functions: 
<code><a href="polar_cluster.html">polar_cluster</a>()</code>,
<code><a href="polar_diff.html">polar_diff</a>()</code>,
<code><a href="polar_freq.html">polar_freq</a>()</code>,
<code><a href="polar_plot.html">polar_plot</a>()</code>,
<code><a href="pollutionrose.html">pollutionrose</a>()</code>,
<code><a href="rose_metbias.html">rose_metbias</a>()</code>,
<code><a href="rose_percentile.html">rose_percentile</a>()</code>,
<code><a href="rose_wind.html">rose_wind</a>()</code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Jack Davison, David Carslaw.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

